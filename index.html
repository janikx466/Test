<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Send PDF Data to Main API</title>
<style>
body { font-family: Arial; max-width:600px; margin:40px auto; padding:20px; }
h2 { color: #333; }
input, button { width:100%; padding:10px; margin:5px 0; font-size:16px; }
button { background:#4CAF50; color:white; border:none; cursor:pointer; }
button:hover { background:#45a049; }
pre { background:#f4f4f4; padding:10px; border-radius:6px; overflow-x:auto; }
</style>
</head>
<body>
<h2>Send PDF Data to Main API</h2>

<p>1️⃣ Select PDF file:</p>
<input type="file" id="pdfFile">

<p>2️⃣ API URL (auto-set for Hugging Face deployed app):</p>
<input type="text" id="apiURL" readonly value="https://sughrahanif-my-fast.hf.space/api/add-user">

<button onclick="sendPDF()">Send PDF Data</button>

<pre id="response"></pre>

<script src="https://unpkg.com/pdfjs-dist/build/pdf.min.js"></script>
<script>
async function sendPDF() {
    const fileInput = document.getElementById("pdfFile");
    const apiURL = document.getElementById("apiURL").value.trim();

    if(fileInput.files.length===0){ alert("Select a PDF file"); return; }

    const file = fileInput.files[0];
    const reader = new FileReader();

    reader.onload = async function(e) {
        const typedarray = new Uint8Array(e.target.result);
        const pdf = await pdfjsLib.getDocument(typedarray).promise;
        let textContent = "";

        for(let i=0; i<pdf.numPages; i++){
            const page = await pdf.getPage(i+1);
            const text = await page.getTextContent();
            text.items.forEach(item => textContent += item.str + "\n");
        }

        // Extract Name, Age, Email
        const lines = textContent.split("\n");
        let data = {};
        lines.forEach(line => {
            if(line.toLowerCase().startsWith("name:")) data.name = line.split(":")[1].trim();
            if(line.toLowerCase().startsWith("age:")) data.age = parseInt(line.split(":")[1].trim());
            if(line.toLowerCase().startsWith("email:")) data.email = line.split(":")[1].trim();
        });

        if(!data.name || !data.age || !data.email){
            alert("PDF must contain Name, Age, and Email in proper format.");
            return;
        }

        // Send to Main API
        try {
            const res = await fetch(apiURL, {
                method: "POST",
                mode: "cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            const json = await res.json();
            document.getElementById("response").textContent = JSON.stringify(json, null, 2);
            alert("✅ Data sent successfully!");
        } catch(err){
            console.error("Fetch error:", err);
            alert("❌ Error sending data to API. Check console for details.");
        }
    };

    reader.readAsArrayBuffer(file);
}
</script>
</body>
</html>
